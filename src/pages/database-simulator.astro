---
// database-simulator.astro
import Layout from '../layouts/Layout.astro';
---

<Layout title="データベース正規化シミュレータ - じょうほうらいふ">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover, shrink-to-fit=no">

    <link rel="stylesheet" href="/database-simulator/styles/main.css">
    <link rel="stylesheet" href="/database-simulator/styles/mobile.css">
    <link rel="stylesheet" href="/database-simulator/styles/terminal.css">

    <div class="app-container">
        <!-- ツールバー -->
        <div class="toolbar">
            <div class="toolbar-title">
                <span>🗄️</span>
                データベース正規化シミュレータ
            </div>
            <div class="toolbar-buttons">
                <button id="add-table-btn" class="toolbar-btn">
                    <span>➕</span>
                    新しいテーブル
                </button>
                <button id="undo-btn" class="toolbar-btn" disabled>
                    <span>↶</span>
                    戻る
                </button>
                <button id="redo-btn" class="toolbar-btn" disabled>
                    <span>↷</span>
                    進む
                </button>
                <button id="help-toggle-btn" class="toolbar-btn">
                    <span>❓</span>
                    使い方
                </button>
                <label class="toolbar-checkbox">
                    <input type="checkbox" id="show-all-records-checkbox">
                    <span>全レコード表示</span>
                </label>
                <button id="remove-duplicates-btn" class="toolbar-btn">
                    <span>🧹</span>
                    重複レコード削除
                </button>
                <button id="reset-btn" class="toolbar-btn">
                    <span>🔄</span>
                    リセット
                </button>
                <button id="save-db-btn" class="toolbar-btn">
                    <span>💾</span>
                    保存
                </button>
                <button id="load-db-btn" class="toolbar-btn">
                    <span>📁</span>
                    読込
                </button>
                <button id="import-csv-btn" class="toolbar-btn">
                    <span>📊</span>
                    CSV読込
                </button>
                <button id="sql-terminal-btn" class="toolbar-btn">
                    <span>💻</span>
                    SQLコマンド
                </button>
            </div>
        </div>

        <!-- メインキャンバス -->
        <div class="main-canvas">
            <div class="canvas-container">
                <canvas id="database-canvas"></canvas>

                <!-- 削除エリア -->
                <div class="delete-area" id="delete-area">
                    <div class="delete-area-content">
                        <span class="delete-icon">🗑️</span>
                        <span class="delete-text">ここにドロップで削除</span>
                    </div>
                </div>

                <!-- ヘルプパネル -->
                <div class="help-panel" id="help-panel">
                    <div class="help-panel-header">
                        <h3>📖 使い方</h3>
                        <button class="help-close-btn" id="help-close-btn">×</button>
                    </div>

                    <div class="help-item">
                        <span class="help-icon">👆</span>
                        <span class="help-text">テーブルをドラッグして移動</span>
                    </div>

                    <div class="help-item">
                        <span class="help-icon">✊</span>
                        <span class="help-text">列をクリックして選択<br>別のテーブルにドラッグで移動</span>
                    </div>

                    <div class="help-item">
                        <span class="help-icon">🔑</span>
                        <span class="help-text">列を右クリック（長押し）で主キー設定</span>
                    </div>

                    <div class="help-item">
                        <span class="help-icon">🔍</span>
                        <span class="help-text">ホイール（ピンチ）でズーム</span>
                    </div>

                    <div class="help-item">
                        <span class="help-icon">🖐️</span>
                        <span class="help-text">空白をドラッグ（2本指）でパン</span>
                    </div>
                </div>

                <!-- SQLターミナル -->
                <div class="sql-terminal-modal" id="sql-terminal-modal">
                    <div class="sql-terminal-container">
                        <div class="sql-terminal-header">
                            <h3>💻 SQLターミナル</h3>
                            <button class="sql-terminal-close-btn" id="sql-terminal-close-btn">×</button>
                        </div>
                        <div class="sql-terminal-output" id="sql-terminal-output">
                            <div class="terminal-welcome">
                                データベース正規化シミュレータ SQLターミナル v1.0
                                <br>使用可能なコマンド: SELECT, INSERT, UPDATE, DELETE, CREATE TABLE, DROP TABLE, SHOW TABLES, DESC, JOIN
                                <br>例: SELECT * FROM テーブル名;
                                <br>　　SELECT * FROM テーブル名 ORDER BY 列名 DESC LIMIT 10;
                                <br>　　SELECT * FROM テーブル1 JOIN テーブル2 ON テーブル1.列名 = テーブル2.列名 LIMIT 5;
                                <br>
                            </div>
                        </div>
                        <div class="sql-terminal-input-area">
                            <span class="sql-terminal-prompt">SQL&gt;</span>
                            <textarea class="sql-terminal-input" id="sql-terminal-input" placeholder="SQLコマンドを入力してください&#x0A;（Shift+Enterで改行、Enterで実行）" autocomplete="off" rows="1"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- スクリプト -->
    <script src="/database-simulator/scripts/core/sql-engine.js" is:inline></script>
    <script src="/database-simulator/scripts/core/sql-terminal.js" is:inline></script>
    <script src="/database-simulator/scripts/core/database-simulator.js" is:inline></script>

    <style>
        /* ページ固有のスタイル */
        :global(html),
        :global(body) {
            height: 100vh;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        /* フッターを非表示 */
        :global(.footer) {
            display: none;
        }

        /* Layout から継承される余白をリセット */
        :global(.main-content) {
            max-width: none;
            padding: 0;
            margin: 0;
            flex: 1;
            overflow: hidden;
        }
    </style>
</Layout>
