id: database-normalization-2
title: データベース正規化課題②
description: 病院予約システムのデータを正規化し、完成したJSONファイルをアップロードして、正規化が正しく行われているかを判定します
icon: 🗄️
difficulty: hard
estimatedTime: 40
category: データベース
tags:
  - データベース
  - 正規化
  - テーブル設計
  - シミュレータ
  - 複数マスタ
questions:
  - id: hospital-normalization
    type: file-upload
    title: 病院予約システムデータの正規化
    description: |
      **課題内容**

      病院の予約管理システムのデータを第3正規形まで正規化してください。

      **配布ファイル**
      - <a href="/database-normalization/normalization-2.csv" download style="color: #3b82f6; text-decoration: underline;">normalization-2.csv</a>をダウンロードしてください

      **正規化の手順**
      1. データベース正規化シミュレータ（<a href="/database-simulator" target="_blank" style="color: #3b82f6; text-decoration: underline;">/database-simulator</a>）を開く
      2. 「リセット」ボタンを押して初期状態にする
      3. 「CSV読込」ボタンを押し、ダウンロードしたnormalization-2.csvを読み込む
      4. 列を適切なテーブルに移動して正規化を行う
      5. 完成したら「保存」ボタンでJSONファイルをダウンロード
      6. このページにJSONファイルをアップロードして判定

      **正規化の要件**
      - 予約トランザクションテーブル（予約ID、予約日時、患者ID、診療科ID、医師ID、診察室、診察時間、診察内容、処方箋番号）
      - 患者マスタテーブル（患者ID、患者名、患者生年月日、患者電話番号、患者住所、患者保険証番号）
      - 診療科マスタテーブル（診療科ID、診療科名、診療科フロア）
      - 医師マスタテーブル（医師ID、医師名、医師専門分野、医師免許番号、診療科ID）
      - 処方箋マスタテーブル（処方箋番号、薬剤名、投薬日数）
      - 各テーブルには適切な主キーが設定されていること
      - テーブル間に適切なリレーションが設定されていること

      **判定条件**
      - 5つのテーブルが存在する
      - 各テーブルに適切な列が配置されている
      - 主キーが正しく設定されている（テーブル名は問わない）
      - データの整合性が保たれている
      - リレーションが適切に設定されている
    explanation: |
      この課題では、非正規化された病院予約システムのデータを第3正規形まで正規化しました。

      **正規化のポイント**

      **第1正規形（1NF）**
      - すべてのカラムが原子値（分割できない値）であること
      - 繰り返しグループがないこと

      **第2正規形（2NF）**
      - 1NFを満たしていること
      - 部分関数従属を排除すること
      - 主キーの一部だけに従属する列がないこと

      **第3正規形（3NF）**
      - 2NFを満たしていること
      - 推移的関数従属を排除すること
      - 主キー以外のキーに従属する列がないこと

      **今回の正規化**

      元のデータには以下の問題がありました：
      - 患者情報（患者名、生年月日、電話番号、住所、保険証番号）が予約レコードごとに重複
      - 診療科情報（診療科名、フロア）が予約レコードごとに重複
      - 医師情報（医師名、専門分野、免許番号）が予約レコードごとに重複
      - 処方箋情報（薬剤名、投薬日数）が予約レコードごとに重複
      - データの更新異常（患者の電話番号変更時に複数レコードを更新する必要）
      - データの削除異常（予約履歴を削除すると患者情報も消える）
      - データの挿入異常（予約がない患者や医師の情報を登録できない）

      正規化のヒント：
      - 予約トランザクション情報を管理するテーブル
      - 患者情報を管理するマスタテーブル
      - 診療科情報を管理するマスタテーブル
      - 医師情報を管理するマスタテーブル
      - 処方箋情報を管理するマスタテーブル

      この5つのテーブルに分割することで：
      - データの重複がなくなり、ストレージ効率が向上
      - 更新・削除・挿入の異常が解消
      - データの整合性が保証される
      - 各エンティティが独立して管理できる
      - 医師と診療科の関係も適切に管理できる
    difficulty: hard
    points: 30
    tags:
      - 第3正規形
      - テーブル設計
      - 主キー
      - 外部キー
      - 複数マスタ
